package com.ninegag.app.shared.data.post

import com.ninegag.app.shared.infra.remote.base.ApiBaseResponse
import com.ninegag.app.shared.infra.remote.post.model.ApiPostsResponse
import com.ninegag.app.shared.infra.remote.post.model.ApiUploadResponse
import com.ninegag.app.shared.util.runWithSafeApiResult
import com.under9.shared.core.result.Result
import io.ktor.client.*
import io.ktor.client.call.*
import io.ktor.client.engine.*
import io.ktor.client.engine.mock.*
import io.ktor.client.plugins.contentnegotiation.*
import io.ktor.client.request.*
import io.ktor.http.*
import io.ktor.serialization.kotlinx.json.*
import io.ktor.utils.io.*
import kotlinx.coroutines.runBlocking
import kotlinx.serialization.json.Json
import kotlin.test.Test
import kotlin.test.assertEquals

class RelatedPostsTest {

    class FakeRemotePostDatasource(private val httpClient: HttpClient): RemotePostDatasource {
        override suspend fun deletePost(postId: String): Result<ApiBaseResponse> {
            TODO("Not yet implemented")
        }

        override suspend fun submitPostWithLink(
            uuid: String,
            url: String
        ): Result<ApiUploadResponse> {
            TODO("Not yet implemented")
        }

        override suspend fun getRemoteRelatedPosts(
            postId: String,
            after: String?
        ): Result<ApiPostsResponse> {
            return runWithSafeApiResult {
                httpClient.get("https://test.gg/related-posts") {
                    parameter("id", postId)
                    if (!after.isNullOrBlank()) parameter("after", after)
                }.body()
            }
        }

    }

    private val mockEngine = MockEngine { request ->
        println("request url: ${request.url}")
        when(request.url.parameters["id"]) {
            "gg" -> {
                respond(
                    content = ByteReadChannel("""{"meta":{"timestamp":1663345649,"status":"Failure","sid":"9gVQ01EVjlHTUVkMMRVT6xEVFJzTB1TY"}},"data":{}"""),
                    status = HttpStatusCode.OK,
                    headers = headersOf(HttpHeaders.ContentType, "application/json")
                )
            }
            else -> {
                respond(
                    content = ByteReadChannel("""{"meta":{"timestamp":1663345649,"status":"Success","sid":"9gVQ01EVjlHTUVkMMRVT6xEVFJzTB1TY"},"data":{"posts":[{"id":"a8WjWv3","url":"http://9jokes.com/gag/a8WjWv3","status":"0","title":"Im bambi","description":"","type":"Photo","version":0,"nsfw":0,"upVoteCount":2,"downVoteCount":0,"totalVoteCount":2,"viewsCount":0,"score":0,"reportedStatus":0,"creationTs":1663279145,"albumWebUrl":"","hasImageTile":0,"postTile":{"h800":{"width":700,"height":841,"images":[{"width":700,"height":800,"url":"https://stg-img-9gag-fun.9cache.com/photo/a8WjWv3_h800_offset0.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/a8WjWv3_h800wp_offset0.webp"},{"width":700,"height":41,"url":"https://stg-img-9gag-fun.9cache.com/photo/a8WjWv3_h800_offset1.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/a8WjWv3_h800wp_offset1.webp"}]}},"promoted":0,"isVoteMasked":0,"sortTs":1,"orderId":20000000,"hasLongPostCover":0,"images":{"image700":{"width":700,"height":841,"url":"https://stg-img-9gag-fun.9cache.com/photo/a8WjWv3_700b.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/a8WjWv3_700bwp.webp"},"image460":{"width":460,"height":553,"url":"https://stg-img-9gag-fun.9cache.com/photo/a8WjWv3_460s.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/a8WjWv3_460swp.webp"},"imageFbThumbnail":{"width":220,"height":220,"url":"https://stg-img-9gag-fun.9cache.com/photo/a8WjWv3_fbthumbnail.jpg"},"imageXLarge":{"width":745,"height":896,"url":"https://stg-img-9gag-fun.9cache.com/photo/19fee2a1b7/a8WjWv3_xlarge.jpg"}},"colors":{"placeholder":"#C0AF9C"},"sourceDomain":"","sourceUrl":"","externalUrl":"","channel":"","isVoted":"0","userScore":0,"creator":{"userId":"-1","accountId":"-1","loginName":"9GAGGER","profileUrl":"https://9jokes.com","avatarUrlLarge":"https://stg-miscmedia-9gag-fun.9cache.com/img/avatar/anonymous_100_v0.jpg","avatarUrlMedium":"https://stg-miscmedia-9gag-fun.9cache.com/img/avatar/anonymous_100_v0.jpg","avatarUrlSmall":"https://stg-miscmedia-9gag-fun.9cache.com/img/avatar/anonymous_100_v0.jpg","avatarUrlTiny":"https://stg-miscmedia-9gag-fun.9cache.com/img/avatar/anonymous_100_v0.jpg","fullName":"9GAGGER","about":"My Funny Collection","country":"","location":"","emojiStatus":"","isActivePro":0,"isActiveProPlus":0,"isVerifiedAccount":0,"creationTs":0,"activeTs":0,"uploadTs":0,"preferences":{"hideProBadge":0,"hideActiveTs":0,"accentColor":"","backgroundColor":""},"website":"","permissions":{},"profileColor":""},"isAnonymous":true,"commentsCount":4,"fbShares":0,"tweetCount":0,"created":"","comment":{"listType":"comment","updateTs":1663280902,"latestCommentText":"","opToken":"BIZiE7Z7lgBfORy+u5A2DQ==.AnSEFS754VdXNLULIgE9KWwnAJHLzQOu2ZUMx0xvr0QKf5ufk3KZ9cGp0+EaN/pizPnJDE0J5Y1rTgsk/ClFXXGzqrM8fyY9j0rLknrJSq04QHfitMHr3fhXntd/pvgg3T+IW92LWln/8SLdftyyA+ubfIlMRCDqcrmrS20WqZ8gavYTrWvKqk3krnayese9","canAnonymous":true},"commentOpClientId":"","commentOpSignature":"","commentSystem":"comment-system","topComments":{"comments":[]},"targetedAdTags":{},"postSection":{"name":"Animals","url":"https://9jokes.com/animals","imageUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099902.3827_edY2ar_100x100.jpg","webpUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099902.3827_edY2ar_100x100wp.webp","sectionTag":"Animals"},"tags":[{"key":"Animals","url":"https://9jokes.com/tag/animals"},{"key":"cute animals","url":"https://9jokes.com/tag/cute-animals"},{"key":"bambi","url":"https://9jokes.com/tag/bambi"},{"key":"qqq","url":"https://9jokes.com/tag/qqq"}]},{"id":"aD0m0qx","url":"http://9jokes.com/gag/aD0m0qx","status":"0","title":"So short so qq","description":"","type":"Photo","version":0,"nsfw":0,"upVoteCount":2,"downVoteCount":0,"totalVoteCount":2,"viewsCount":0,"score":0,"reportedStatus":0,"creationTs":1663279044,"albumWebUrl":"","hasImageTile":0,"postTile":{"h800":{"width":605,"height":344,"images":[{"width":605,"height":344,"url":"https://stg-img-9gag-fun.9cache.com/photo/aD0m0qx_h800_offset0.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/aD0m0qx_h800wp_offset0.webp"}]}},"promoted":0,"isVoteMasked":0,"sortTs":1,"orderId":19999999,"hasLongPostCover":0,"images":{"image700":{"width":605,"height":344,"url":"https://stg-img-9gag-fun.9cache.com/photo/aD0m0qx_700b.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/aD0m0qx_700bwp.webp"},"image460":{"width":460,"height":261,"url":"https://stg-img-9gag-fun.9cache.com/photo/aD0m0qx_460s.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/aD0m0qx_460swp.webp"},"imageFbThumbnail":{"width":220,"height":220,"url":"https://stg-img-9gag-fun.9cache.com/photo/aD0m0qx_fbthumbnail.jpg"}},"colors":{"placeholder":"#30251E"},"sourceDomain":"","sourceUrl":"","externalUrl":"","channel":"","isVoted":"0","userScore":0,"creator":{"userId":"13173977","accountId":"15010376","loginName":"wallyabcde","profileUrl":"https://9jokes.com/u/wallyabcde","avatarUrlLarge":"https://accounts-cdn.9jokes.com/media/default-avatar/1_173_800_v0.jpg","avatarUrlMedium":"https://accounts-cdn.9jokes.com/media/default-avatar/1_173_100_v0.jpg","avatarUrlSmall":"https://accounts-cdn.9jokes.com/media/default-avatar/1_173_100_v0.jpg","avatarUrlTiny":"https://accounts-cdn.9jokes.com/media/default-avatar/1_173_100_v0.jpg","fullName":"Hdjbdbx","about":"My Funny Collection","country":"hk","location":"hk","emojiStatus":"üòÅ","isActivePro":1,"isActiveProPlus":0,"isVerifiedAccount":1,"creationTs":1650606096,"activeTs":1663279365,"uploadTs":1663279145,"preferences":{"hideProBadge":0,"hideActiveTs":0,"accentColor":"","backgroundColor":""},"website":"","permissions":{"9GAG_Pro":{"name":"9GAG_Pro","expirationTs":-1}},"profileColor":""},"isAnonymous":false,"commentsCount":4,"fbShares":0,"tweetCount":0,"created":"","comment":{"listType":"comment","updateTs":1663280858,"latestCommentText":"","opToken":"VED9AhCRN0a4BPtqAzuswA==.h8mnhar9WWJtXgaqGMxCv32Pf1zBhfM/SOXwMtb0PjtMW8ah3yWFBpGyL1HRdmhhRcmZ09vlCEPje3qAUV8YE91LgLEMZ8a1zkh7zTw3S8cncuqVmuFLR4EFAF6aaRszaDkr68K1bWCZwIMds0Wtj0vdw7K8pFaPmfRlZMvVCxkb80VpXGKYmn1/Ouuz+98a","canAnonymous":false},"commentOpClientId":"","commentOpSignature":"","commentSystem":"comment-system","topComments":{"comments":[]},"targetedAdTags":{},"postSection":{"name":"Animals","url":"https://9jokes.com/animals","imageUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099902.3827_edY2ar_100x100.jpg","webpUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099902.3827_edY2ar_100x100wp.webp","sectionTag":"Animals"},"tags":[{"key":"Animals","url":"https://9jokes.com/tag/animals"},{"key":"Oil","url":"https://9jokes.com/tag/oil"},{"key":"animal","url":"https://9jokes.com/tag/animal"},{"key":"qqq","url":"https://9jokes.com/tag/qqq"}]},{"id":"a6wLwx2","url":"http://9jokes.com/gag/a6wLwx2","status":"0","title":"Money cat","description":"","type":"Photo","version":0,"nsfw":0,"upVoteCount":1,"downVoteCount":0,"totalVoteCount":1,"viewsCount":0,"score":0,"reportedStatus":0,"creationTs":1663146125,"albumWebUrl":"","hasImageTile":0,"postTile":{"h800":{"width":700,"height":699,"images":[{"width":700,"height":699,"url":"https://stg-img-9gag-fun.9cache.com/photo/a6wLwx2_h800_offset0.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/a6wLwx2_h800wp_offset0.webp"}]}},"promoted":0,"isVoteMasked":0,"sortTs":1,"orderId":19999998,"hasLongPostCover":0,"images":{"image700":{"width":700,"height":699,"url":"https://stg-img-9gag-fun.9cache.com/photo/a6wLwx2_700b.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/a6wLwx2_700bwp.webp"},"image460":{"width":460,"height":459,"url":"https://stg-img-9gag-fun.9cache.com/photo/a6wLwx2_460s.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/a6wLwx2_460swp.webp"},"imageFbThumbnail":{"width":220,"height":220,"url":"https://stg-img-9gag-fun.9cache.com/photo/a6wLwx2_fbthumbnail.jpg"},"imageXLarge":{"width":1600,"height":1598,"url":"https://stg-img-9gag-fun.9cache.com/photo/92cd004a67/a6wLwx2_xlarge.jpg"}},"colors":{"placeholder":"#C6B198"},"sourceDomain":"","sourceUrl":"","externalUrl":"","channel":"","isVoted":"0","userScore":0,"creator":{"userId":"-1","accountId":"-1","loginName":"9GAGGER","profileUrl":"https://9jokes.com","avatarUrlLarge":"https://stg-miscmedia-9gag-fun.9cache.com/img/avatar/anonymous_100_v0.jpg","avatarUrlMedium":"https://stg-miscmedia-9gag-fun.9cache.com/img/avatar/anonymous_100_v0.jpg","avatarUrlSmall":"https://stg-miscmedia-9gag-fun.9cache.com/img/avatar/anonymous_100_v0.jpg","avatarUrlTiny":"https://stg-miscmedia-9gag-fun.9cache.com/img/avatar/anonymous_100_v0.jpg","fullName":"9GAGGER","about":"My Funny Collection","country":"","location":"","emojiStatus":"","isActivePro":0,"isActiveProPlus":0,"isVerifiedAccount":0,"creationTs":0,"activeTs":0,"uploadTs":0,"preferences":{"hideProBadge":0,"hideActiveTs":0,"accentColor":"","backgroundColor":""},"website":"","permissions":{},"profileColor":""},"isAnonymous":true,"commentsCount":3,"fbShares":0,"tweetCount":0,"created":"","comment":{"listType":"comment","updateTs":1663150600,"latestCommentText":"","opToken":"YYutSUnYQFY4gFqKTOG7AA==.iRtK3r4mTiRLqVXb74cRvkTSi30nRxwPBM1vtEckZj2ekFOeD/da+lFKqOcDMCbodUc3voyOtOHN6slkVHI6+nPkeRf2jZGZb8OghLaf209JHC0ubxrz/K5ncdfm4F/AVuwMeotwtN2h030diY5nrBxX7drMOQpHPwbij3lwWW4Q2bmXcUA34ce3DoU6F6cY","canAnonymous":true},"commentOpClientId":"","commentOpSignature":"","commentSystem":"comment-system","topComments":{"comments":[]},"targetedAdTags":{},"postSection":{"name":"Animals","url":"https://9jokes.com/animals","imageUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099902.3827_edY2ar_100x100.jpg","webpUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099902.3827_edY2ar_100x100wp.webp","sectionTag":"Animals"},"tags":[{"key":"Animals","url":"https://9jokes.com/tag/animals"},{"key":"cat","url":"https://9jokes.com/tag/cat"},{"key":"dog","url":"https://9jokes.com/tag/dog"},{"key":"husky","url":"https://9jokes.com/tag/husky"}]},{"id":"arpRpAy","url":"http://9jokes.com/gag/arpRpAy","status":"0","title":"This is a bear","description":"","type":"Photo","version":0,"nsfw":0,"upVoteCount":0,"downVoteCount":0,"totalVoteCount":0,"viewsCount":0,"score":0,"reportedStatus":0,"creationTs":1662722592,"albumWebUrl":"","hasImageTile":0,"postTile":{"h800":{"width":500,"height":521,"images":[{"width":500,"height":521,"url":"https://stg-img-9gag-fun.9cache.com/photo/arpRpAy_h800_offset0.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/arpRpAy_h800wp_offset0.webp"}]}},"promoted":0,"isVoteMasked":0,"sortTs":1,"orderId":19999997,"hasLongPostCover":0,"images":{"image700":{"width":500,"height":521,"url":"https://stg-img-9gag-fun.9cache.com/photo/arpRpAy_700b.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/arpRpAy_700bwp.webp"},"image460":{"width":460,"height":479,"url":"https://stg-img-9gag-fun.9cache.com/photo/arpRpAy_460s.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/arpRpAy_460swp.webp"},"imageFbThumbnail":{"width":220,"height":220,"url":"https://stg-img-9gag-fun.9cache.com/photo/arpRpAy_fbthumbnail.jpg"}},"colors":{"placeholder":"#525154"},"sourceDomain":"","sourceUrl":"","externalUrl":"","channel":"","isVoted":"0","userScore":0,"creator":{"userId":"13173921","accountId":"15010338","loginName":"kitf","profileUrl":"https://9jokes.com/u/kitf","avatarUrlLarge":"https://accounts-cdn.9jokes.com/media/avatar/15010338_800_1.jpg","avatarUrlMedium":"https://accounts-cdn.9jokes.com/media/avatar/15010338_100_1.jpg","avatarUrlSmall":"https://accounts-cdn.9jokes.com/media/avatar/15010338_100_1.jpg","avatarUrlTiny":"https://accounts-cdn.9jokes.com/media/avatar/15010338_100_1.jpg","fullName":"Kit Fong","about":"My Funny Collection","country":"hk","location":"hk","emojiStatus":"üòÅ","isActivePro":1,"isActiveProPlus":1,"isVerifiedAccount":0,"creationTs":1649067848,"activeTs":1663317348,"uploadTs":1663146125,"preferences":{"hideProBadge":0,"hideActiveTs":0,"accentColor":"Green","backgroundColor":""},"website":"","permissions":{"9GAG_Pro":{"name":"9GAG_Pro","expirationTs":-1},"9GAG_Pro_Plus":{"name":"9GAG_Pro_Plus","expirationTs":-1}},"profileColor":""},"isAnonymous":false,"commentsCount":3,"fbShares":0,"tweetCount":0,"created":"","comment":{"listType":"comment","updateTs":1663279332,"latestCommentText":"","opToken":"nWwri5v/aFgBwPdX7e6M2w==.Df6ob/GdTMz04r1fnae/UFLCuy2IwFvz7RcUdBewV/+PFG4WLCfqwac6TQvm0LqiRTjyvI9hjL2ZBGh1D+1L1+3vwqWI9P3ZaYRp2epl7zBPL8gM38Ag+7NoPR7Sg9erQwUVsqRCoK09zJ31G0PXy80Tz6xwo2VaqPLJOIru0CLK7hHH+bm/sa9t8NKgzQQ6","canAnonymous":false},"commentOpClientId":"","commentOpSignature":"","commentSystem":"comment-system","topComments":{"comments":[]},"targetedAdTags":{},"postSection":{"name":"Animals","url":"https://9jokes.com/animals","imageUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099902.3827_edY2ar_100x100.jpg","webpUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099902.3827_edY2ar_100x100wp.webp","sectionTag":"Animals"},"tags":[{"key":"Animals","url":"https://9jokes.com/tag/animals"},{"key":"water","url":"https://9jokes.com/tag/water"}]},{"id":"ajrnrOg","url":"http://9jokes.com/gag/ajrnrOg","status":"0","title":"Is this an animal?","description":"","type":"Photo","version":0,"nsfw":0,"upVoteCount":0,"downVoteCount":0,"totalVoteCount":0,"viewsCount":0,"score":0,"reportedStatus":0,"creationTs":1662722444,"albumWebUrl":"","hasImageTile":0,"postTile":{"h800":{"width":700,"height":525,"images":[{"width":700,"height":525,"url":"https://stg-img-9gag-fun.9cache.com/photo/ajrnrOg_h800_offset0.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/ajrnrOg_h800wp_offset0.webp"}]}},"promoted":0,"isVoteMasked":0,"sortTs":1,"orderId":19999996,"hasLongPostCover":0,"images":{"image700":{"width":700,"height":525,"url":"https://stg-img-9gag-fun.9cache.com/photo/ajrnrOg_700b.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/ajrnrOg_700bwp.webp"},"image460":{"width":460,"height":345,"url":"https://stg-img-9gag-fun.9cache.com/photo/ajrnrOg_460s.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/ajrnrOg_460swp.webp"},"imageFbThumbnail":{"width":220,"height":220,"url":"https://stg-img-9gag-fun.9cache.com/photo/ajrnrOg_fbthumbnail.jpg"},"imageXLarge":{"width":800,"height":600,"url":"https://stg-img-9gag-fun.9cache.com/photo/33d9410541/ajrnrOg_xlarge.jpg"}},"colors":{"placeholder":"#EB9C48"},"sourceDomain":"","sourceUrl":"","externalUrl":"","channel":"","isVoted":"0","userScore":0,"creator":{"userId":"13173921","accountId":"15010338","loginName":"kitf","profileUrl":"https://9jokes.com/u/kitf","avatarUrlLarge":"https://accounts-cdn.9jokes.com/media/avatar/15010338_800_1.jpg","avatarUrlMedium":"https://accounts-cdn.9jokes.com/media/avatar/15010338_100_1.jpg","avatarUrlSmall":"https://accounts-cdn.9jokes.com/media/avatar/15010338_100_1.jpg","avatarUrlTiny":"https://accounts-cdn.9jokes.com/media/avatar/15010338_100_1.jpg","fullName":"Kit Fong","about":"My Funny Collection","country":"hk","location":"hk","emojiStatus":"üòÅ","isActivePro":1,"isActiveProPlus":1,"isVerifiedAccount":0,"creationTs":1649067848,"activeTs":1663317348,"uploadTs":1663146125,"preferences":{"hideProBadge":0,"hideActiveTs":0,"accentColor":"Green","backgroundColor":""},"website":"","permissions":{"9GAG_Pro":{"name":"9GAG_Pro","expirationTs":-1},"9GAG_Pro_Plus":{"name":"9GAG_Pro_Plus","expirationTs":-1}},"profileColor":""},"isAnonymous":false,"commentsCount":0,"fbShares":0,"tweetCount":0,"created":"","comment":{"listType":"comment","updateTs":1662722444,"latestCommentText":"","opToken":"NxDXQKuGkY/JP3DnhOG2VA==.WGoZNBW9z2iDjbnE5jSwWNkqqEz6ma4xMmX7K3rUMfL+P+YJr6IPzq18I6QOmaSw3e1O8uV2exD4CCXEueoRsOjNzJ1mlcrhAOnzjCFCceTEKCTqnKF81cACvoc8SsYiQSzF0f+usafK1zp/1lenkAOiVs1aZKv+TS0Bv4NE4EVWWYEKZzMC8jVcyuxr8SWe","canAnonymous":false},"commentOpClientId":"","commentOpSignature":"","commentSystem":"comment-system","topComments":{"comments":[]},"targetedAdTags":{},"postSection":{"name":"Funny","url":"https://9jokes.com/funny","imageUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099501.5492_DeHAWE_100x100.jpg","webpUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099501.5492_DeHAWE_100x100wp.webp","sectionTag":"Funny"},"tags":[{"key":"Funny","url":"https://9jokes.com/tag/funny"},{"key":"Animals","url":"https://9jokes.com/tag/animals"}]},{"id":"aZPNP00","url":"http://9jokes.com/gag/aZPNP00","status":"0","title":"Black and black","description":"","type":"Photo","version":0,"nsfw":1,"upVoteCount":1,"downVoteCount":0,"totalVoteCount":1,"viewsCount":0,"score":0,"reportedStatus":0,"creationTs":1662459423,"albumWebUrl":"","hasImageTile":0,"postTile":{"h800":{"width":700,"height":527,"images":[{"width":700,"height":527,"url":"https://stg-img-9gag-fun.9cache.com/photo/aZPNP00_h800_offset0.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/aZPNP00_h800wp_offset0.webp"}]}},"promoted":0,"isVoteMasked":0,"sortTs":1,"orderId":19999995,"hasLongPostCover":0,"images":{"image700":{"width":700,"height":527,"url":"https://stg-img-9gag-fun.9cache.com/photo/aZPNP00_700b.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/aZPNP00_700bwp.webp"},"image460":{"width":460,"height":346,"url":"https://stg-img-9gag-fun.9cache.com/photo/aZPNP00_460s.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/aZPNP00_460swp.webp"},"imageFbThumbnail":{"width":220,"height":220,"url":"https://stg-img-9gag-fun.9cache.com/photo/aZPNP00_fbthumbnail.jpg"},"imageXLarge":{"width":1920,"height":1446,"url":"https://stg-img-9gag-fun.9cache.com/photo/15993ec0d4/aZPNP00_xlarge.jpg"}},"colors":{"placeholder":"#211813"},"sourceDomain":"","sourceUrl":"","externalUrl":"","channel":"","isVoted":"1","userScore":1,"creator":{"userId":"13173558","accountId":"15010037","loginName":"kin","profileUrl":"https://9jokes.com/u/kin","avatarUrlLarge":"https://accounts-cdn.9jokes.com/media/default-avatar/1_6_800_v0.jpg","avatarUrlMedium":"https://accounts-cdn.9jokes.com/media/default-avatar/1_6_100_v0.jpg","avatarUrlSmall":"https://accounts-cdn.9jokes.com/media/default-avatar/1_6_100_v0.jpg","avatarUrlTiny":"https://accounts-cdn.9jokes.com/media/default-avatar/1_6_100_v0.jpg","fullName":"Kinisanormaluser","about":"My Funny Collection","country":"","location":"hk","emojiStatus":"","isActivePro":0,"isActiveProPlus":0,"isVerifiedAccount":0,"creationTs":1636704814,"activeTs":1663060676,"uploadTs":1662462413,"preferences":{"hideProBadge":0,"hideActiveTs":0,"accentColor":"","backgroundColor":""},"website":"","permissions":{},"profileColor":""},"isAnonymous":false,"commentsCount":0,"fbShares":0,"tweetCount":0,"created":"","comment":{"listType":"comment","updateTs":1662459423,"latestCommentText":"","opToken":"vVXwq1MgvDLnDFsYcWrmhg==.w0BJqM78huCYDQp9BFc1wHd8kqpar8VQ7qHjTVO8Hkj7bB+lY6oWedbqaLAbTddCO6U57UOA5slUq/59CdbItlwF9xl4aEdHnf6HVVH7MAbU+wGYMEkEtwTVrHAvghbj1xI4wznlUPjlbPyKNDdNrCls8s/siHJoLE47qka1fP72FuJpUZuBjdTNOEYuAXOX","canAnonymous":false},"commentOpClientId":"","commentOpSignature":"","commentSystem":"comment-system","topComments":{"comments":[]},"targetedAdTags":{},"postSection":{"name":"Animals","url":"https://9jokes.com/animals","imageUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099902.3827_edY2ar_100x100.jpg","webpUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099902.3827_edY2ar_100x100wp.webp","sectionTag":"Animals"},"tags":[{"key":"Animals","url":"https://9jokes.com/tag/animals"},{"key":"artistic","url":"https://9jokes.com/tag/artistic"},{"key":"naked","url":"https://9jokes.com/tag/naked"}]},{"id":"a1AYAvR","url":"http://9jokes.com/gag/a1AYAvR","status":"0","title":"I have a rare tag","description":"","type":"Photo","version":0,"nsfw":0,"upVoteCount":1,"downVoteCount":0,"totalVoteCount":1,"viewsCount":0,"score":0,"reportedStatus":0,"creationTs":1661769955,"albumWebUrl":"","hasImageTile":0,"postTile":{"h800":{"width":660,"height":432,"images":[{"width":660,"height":432,"url":"https://stg-img-9gag-fun.9cache.com/photo/a1AYAvR_h800_offset0.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/a1AYAvR_h800wp_offset0.webp"}]}},"promoted":0,"isVoteMasked":0,"sortTs":1,"orderId":19999994,"hasLongPostCover":0,"images":{"image700":{"width":660,"height":432,"url":"https://stg-img-9gag-fun.9cache.com/photo/a1AYAvR_700b.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/a1AYAvR_700bwp.webp"},"image460":{"width":460,"height":301,"url":"https://stg-img-9gag-fun.9cache.com/photo/a1AYAvR_460s.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/a1AYAvR_460swp.webp"},"imageFbThumbnail":{"width":220,"height":220,"url":"https://stg-img-9gag-fun.9cache.com/photo/a1AYAvR_fbthumbnail.jpg"}},"colors":{"placeholder":"#2B527D"},"sourceDomain":"","sourceUrl":"","externalUrl":"","channel":"","isVoted":"0","userScore":0,"creator":{"userId":"13173567","accountId":"15010044","loginName":"echochan","profileUrl":"https://9jokes.com/u/echochan","avatarUrlLarge":"https://accounts-cdn.9jokes.com/media/default-avatar/1_25_800_v0.jpg","avatarUrlMedium":"https://accounts-cdn.9jokes.com/media/default-avatar/1_25_100_v0.jpg","avatarUrlSmall":"https://accounts-cdn.9jokes.com/media/default-avatar/1_25_100_v0.jpg","avatarUrlTiny":"https://accounts-cdn.9jokes.com/media/default-avatar/1_25_100_v0.jpg","fullName":"‰ªäÊôöÊâìËÄÅËôé","about":"My Funny Collection","country":"hk","location":"hk","emojiStatus":"","isActivePro":0,"isActiveProPlus":0,"isVerifiedAccount":0,"creationTs":1637636111,"activeTs":1663301890,"uploadTs":1663082854,"preferences":{"hideProBadge":0,"hideActiveTs":0,"accentColor":"","backgroundColor":""},"website":"","permissions":{},"profileColor":""},"isAnonymous":false,"commentsCount":0,"fbShares":0,"tweetCount":0,"created":"","comment":{"listType":"comment","updateTs":1661769955,"latestCommentText":"","opToken":"gPi3VtdlJz0Gg/xFSoOLug==.VmNd+l5cewfHYO+EzQa2ZvTc1i6G6UfmVJuX76QzfnH/ZGrSvDGec0q59z7vaR4OhK32IjNiy7vGhxsL1xjw1kLNVgxuJ1cANie3LpeTLhwjVbX2gi8my0ufuI88YAZ51Uq25XP9j9P85W5YvEt0Y/wiZAAw+kRDPLtpEttvXzLw+23gE1wvHpFcms/0zmc8","canAnonymous":false},"commentOpClientId":"","commentOpSignature":"","commentSystem":"comment-system","topComments":{"comments":[]},"targetedAdTags":{},"postSection":{"name":"Funny","url":"https://9jokes.com/funny","imageUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099501.5492_DeHAWE_100x100.jpg","webpUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099501.5492_DeHAWE_100x100wp.webp","sectionTag":"Funny"},"tags":[{"key":"Animals","url":"https://9jokes.com/tag/animals"}]},{"id":"aAYpR8o","url":"http://9jokes.com/gag/aAYpR8o","status":"0","title":"Hello world!","description":"","type":"Animated","version":0,"nsfw":0,"upVoteCount":2,"downVoteCount":0,"totalVoteCount":2,"viewsCount":0,"score":0,"reportedStatus":0,"creationTs":1661506713,"albumWebUrl":"","hasImageTile":0,"postTile":{"h800":{"width":700,"height":875,"images":[{"width":700,"height":800,"url":"https://stg-img-9gag-fun.9cache.com/photo/aAYpR8o_h800_offset0.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/aAYpR8o_h800wp_offset0.webp"},{"width":700,"height":75,"url":"https://stg-img-9gag-fun.9cache.com/photo/aAYpR8o_h800_offset1.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/aAYpR8o_h800wp_offset1.webp"}]}},"promoted":0,"isVoteMasked":0,"sortTs":1,"orderId":19999993,"hasLongPostCover":0,"images":{"image700":{"width":460,"height":575,"url":"https://stg-img-9gag-fun.9cache.com/photo/aAYpR8o_460s.jpg"},"image460":{"width":460,"height":575,"url":"https://stg-img-9gag-fun.9cache.com/photo/aAYpR8o_460s.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/aAYpR8o_460swp.webp"},"imageFbThumbnail":{"width":220,"height":220,"url":"https://stg-img-9gag-fun.9cache.com/photo/aAYpR8o_fbthumbnail.jpg"},"imageXLarge":{"width":720,"height":900,"url":"https://stg-img-9gag-fun.9cache.com/photo/f6cd6f871c/aAYpR8o_xlarge.jpg"},"image700ba":{"width":460,"height":575,"url":"https://stg-img-9gag-fun.9cache.com/photo/aAYpR8o_460s.jpg"},"image460sa":{"width":460,"height":575,"url":"https://stg-img-9gag-fun.9cache.com/photo/aAYpR8o_460s.jpg"},"image460sv":{"width":460,"height":574,"url":"https://stg-img-9gag-fun.9cache.com/photo/aAYpR8o_460sv.mp4","hasAudio":1,"duration":9,"vp8Url":"https://stg-img-9gag-fun.9cache.com/photo/aAYpR8o_460svwm.webm"}},"colors":{"placeholder":"#BEAA94"},"sourceDomain":"","sourceUrl":"","externalUrl":"","channel":"","isVoted":"0","userScore":0,"creator":{"userId":"13173434","accountId":"15009790","loginName":"kinisworking","profileUrl":"https://9jokes.com/u/kinisworking","avatarUrlLarge":"https://accounts-cdn.9jokes.com/media/default-avatar/1_163_800_v0.jpg","avatarUrlMedium":"https://accounts-cdn.9jokes.com/media/default-avatar/1_163_100_v0.jpg","avatarUrlSmall":"https://accounts-cdn.9jokes.com/media/default-avatar/1_163_100_v0.jpg","avatarUrlTiny":"https://accounts-cdn.9jokes.com/media/default-avatar/1_163_100_v0.jpg","fullName":"kinisworking","about":"My Funny Collection","country":"hk","location":"hk","emojiStatus":"","isActivePro":0,"isActiveProPlus":0,"isVerifiedAccount":1,"creationTs":1625653017,"activeTs":1663219341,"uploadTs":1661529467,"preferences":{"hideProBadge":0,"hideActiveTs":0,"accentColor":"","backgroundColor":""},"website":"","permissions":{},"profileColor":""},"isAnonymous":false,"commentsCount":0,"fbShares":0,"tweetCount":0,"created":"","comment":{"listType":"comment","updateTs":1661506713,"latestCommentText":"","opToken":"bI+YIEv/hUliLX3D38VLVg==.wF1vL0H2X7mdxJ7FGJGZze+lmot+28gH0Yh5Sy7X8WFwD1F/29E3i4Je8QzF+n+xA0iHZS3dgqGygbA1Rn1E54UZpaPN8BASJDxeLXKaOXhFpkZ+pbjDGevUhTgKG4a7BRHl6FGdzpuLlcgs4lbZJnINoeRDeYj/Gh4mI+h1ZWL0/bjG0e6okeY+hKmE3zaG","canAnonymous":false},"commentOpClientId":"","commentOpSignature":"","commentSystem":"comment-system","topComments":{"comments":[]},"targetedAdTags":{},"postSection":{"name":"Animals","url":"https://9jokes.com/animals","imageUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099902.3827_edY2ar_100x100.jpg","webpUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099902.3827_edY2ar_100x100wp.webp","sectionTag":"Animals"},"tags":[{"key":"Animals","url":"https://9jokes.com/tag/animals"}]},{"id":"azbVgWN","url":"http://9jokes.com/gag/azbVgWN","status":"0","title":"Helon wrodl!","description":"","type":"Animated","version":0,"nsfw":0,"upVoteCount":1,"downVoteCount":0,"totalVoteCount":1,"viewsCount":0,"score":0,"reportedStatus":0,"creationTs":1661506942,"albumWebUrl":"","hasImageTile":0,"postTile":{"h800":{"width":700,"height":875,"images":[{"width":700,"height":800,"url":"https://stg-img-9gag-fun.9cache.com/photo/azbVgWN_h800_offset0.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/azbVgWN_h800wp_offset0.webp"},{"width":700,"height":75,"url":"https://stg-img-9gag-fun.9cache.com/photo/azbVgWN_h800_offset1.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/azbVgWN_h800wp_offset1.webp"}]}},"promoted":0,"isVoteMasked":0,"sortTs":1,"orderId":19999992,"hasLongPostCover":0,"images":{"image700":{"width":460,"height":575,"url":"https://stg-img-9gag-fun.9cache.com/photo/azbVgWN_460s.jpg"},"image460":{"width":460,"height":575,"url":"https://stg-img-9gag-fun.9cache.com/photo/azbVgWN_460s.jpg","webpUrl":"https://stg-img-9gag-fun.9cache.com/photo/azbVgWN_460swp.webp"},"imageFbThumbnail":{"width":220,"height":220,"url":"https://stg-img-9gag-fun.9cache.com/photo/azbVgWN_fbthumbnail.jpg"},"imageXLarge":{"width":720,"height":900,"url":"https://stg-img-9gag-fun.9cache.com/photo/b0b89562e2/azbVgWN_xlarge.jpg"},"image700ba":{"width":460,"height":575,"url":"https://stg-img-9gag-fun.9cache.com/photo/azbVgWN_460s.jpg"},"image460sa":{"width":460,"height":575,"url":"https://stg-img-9gag-fun.9cache.com/photo/azbVgWN_460s.jpg"},"image460sv":{"width":460,"height":574,"url":"https://stg-img-9gag-fun.9cache.com/photo/azbVgWN_460sv.mp4","hasAudio":1,"duration":10,"vp8Url":"https://stg-img-9gag-fun.9cache.com/photo/azbVgWN_460svwm.webm"}},"colors":{"placeholder":"#9C8471"},"sourceDomain":"","sourceUrl":"","externalUrl":"","channel":"","isVoted":"0","userScore":0,"creator":{"userId":"13173434","accountId":"15009790","loginName":"kinisworking","profileUrl":"https://9jokes.com/u/kinisworking","avatarUrlLarge":"https://accounts-cdn.9jokes.com/media/default-avatar/1_163_800_v0.jpg","avatarUrlMedium":"https://accounts-cdn.9jokes.com/media/default-avatar/1_163_100_v0.jpg","avatarUrlSmall":"https://accounts-cdn.9jokes.com/media/default-avatar/1_163_100_v0.jpg","avatarUrlTiny":"https://accounts-cdn.9jokes.com/media/default-avatar/1_163_100_v0.jpg","fullName":"kinisworking","about":"My Funny Collection","country":"hk","location":"hk","emojiStatus":"","isActivePro":0,"isActiveProPlus":0,"isVerifiedAccount":1,"creationTs":1625653017,"activeTs":1663219341,"uploadTs":1661529467,"preferences":{"hideProBadge":0,"hideActiveTs":0,"accentColor":"","backgroundColor":""},"website":"","permissions":{},"profileColor":""},"isAnonymous":false,"commentsCount":0,"fbShares":0,"tweetCount":0,"created":"","comment":{"listType":"comment","updateTs":1661506942,"latestCommentText":"","opToken":"oim41Bzhli5yZ9CLooUSuQ==.Kk9M+AQWSROpXBqOcSGCSjZAfi2YOjWxBZHjuOm3fmp74Gm0Y1/jwOCq98ATh0Cnc0mDCuhsDa9wHMcTNgSnu7vsCHKCZC9QB1J+IpHT8vo2GHFE1tPB2f1nVsYAYhDkJ71kx1tFwZW1xnn12HHmerC1n+ek3DzV8m0ndchS5cEw1PfDrEIbqefS1Irw/u7x","canAnonymous":false},"commentOpClientId":"","commentOpSignature":"","commentSystem":"comment-system","topComments":{"comments":[]},"targetedAdTags":{},"postSection":{"name":"Animals","url":"https://9jokes.com/animals","imageUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099902.3827_edY2ar_100x100.jpg","webpUrl":"https://stg-miscmedia-9gag-fun.9cache.com/images/thumbnail-facebook/1504099902.3827_edY2ar_100x100wp.webp","sectionTag":"Animals"},"tags":[{"key":"Animals","url":"https://9jokes.com/tag/animals"}]}],"after":"eyJlbnRyeUlkIjoiYTc1eWpabSIsIm9yZGVySWQiOjE5OTk5OTkxLCJhZnRlciI6bnVsbH0="}}"""),
                    status = HttpStatusCode.OK,
                    headers = headersOf(HttpHeaders.ContentType, "application/json")
                )
            }
        }
    }
    private val httpClient = HttpClient(mockEngine) {
        install(ContentNegotiation) {
            json(
                Json {
                    ignoreUnknownKeys = true
                    useAlternativeNames = false
                    explicitNulls = false
                    isLenient = true
                }
            )
        }
    }
    private val testClient = FakeRemotePostDatasource(httpClient)

    @Test
    fun loadAndParse_success() {
        runBlocking {
            val result = testClient.getRemoteRelatedPosts("success", null)
            assertEquals(true, result.isSuccess())
            assertEquals("a8WjWv3", result.getOrNull()?.data?.posts?.get(0)?.id)
            assertEquals("eyJlbnRyeUlkIjoiYTc1eWpabSIsIm9yZGVySWQiOjE5OTk5OTkxLCJhZnRlciI6bnVsbH0=", result.getOrNull()?.data?.after)
        }
    }

    @Test
    fun loadAndParse_fail() {
        runBlocking {
            val result = testClient.getRemoteRelatedPosts("gg", null)

            assertEquals(false, result.isSuccess())
        }
    }
}